@model Blog.Models.Post
@using Blog.Models;
@using System.Globalization;
@{
    PersianCalendar pc = new PersianCalendar();
    PMonthString pdc = new PMonthString();
}

@{
    bool isAdmin = ViewBag.IsAdmin ?? false;
    bool showComments = ViewBag.ShowComments ?? true;
    Layout = null;
}
<div class="postTitle"><span class="glyphicon glyphicon-pencil"></span> @Html.DisplayFor(model => model.Title)</div>
<div class="postContainer">
    <div class="postTabs">
        <div class="dateTab">
                <div class="month">@pdc.pdc(pc.GetMonth(Model.DateTime))</div>
                <div class="day">@pc.GetDayOfMonth(Model.DateTime)</div>
                
                @if(ViewBag.IsAdmin)
                {   
                    <div class="tabOpener" data-toggle="tooltip" data-placement="left" title="برای مشاهده اطلاعات این پست کلیک کنید"><span class="glyphicon glyphicon-chevron-down"></span></div> 
                    <div class="editTab">
                        <div>ساعت:</div>      
                        <div>@Model.DateTime.ToString("HH:mm:ss")</div>
                        <span class="glyphicon glyphicon-arrow-down"></span>         
                        <div> اصلاح در:</div>
                        <div>
                            @pc.GetYear(Model.DateModified)/
                            @pc.GetMonth(Model.DateModified)/
                            @pc.GetDayOfMonth(Model.DateModified)
                        </div>
                        <div>@Model.DateModified.ToString("HH:mm:ss")</div>
                    </div>    
                }
        </div>  
        <div class="commentsTab">
            <a href="@Href("~/Posts/Details/" + Model.ID + "#comments")">
                <div class="commentsIcon">.</div> @Model.Comments.Count()
            </a>
        </div>
        
    </div>
    <div class="postContent">
            <div class="postPanel-2">
                <div style="font-weight:bold;">نویسنده : @Model.Author 
                    <div style="float:left;">
                        <a href="#"><span class="fa fa-print"></span></a>
                        <a href="#"><span class="fa fa-envelope-o"></span></a>
                        <a href="#"><span class="fa fa-twitter-square"></span></a>
                        <a href="#"><span class="fa fa-facebook-square"></span></a>
                        <a href="#"><span class="fa fa-linkedin-square"></span></a>
                    </div>
                </div>
            </div>
            <div class="postBody">@(new System.Web.HtmlString(Model.Body))</div>
            <div class="postPanel">
                <div style="padding:5px; font-weight:bold;">تگ ها :</div>
                <div class="tagList">
                    @foreach (Tag tag in Model.Tags)
                    {
                        <span class="tag"><a href="@Href("~/Posts/Tags/" + tag.Name)">@tag.Name<span class="glyphicon glyphicon-tag"></span></a></span>    
                    }
                </div>
            </div>
        </div>
    @if(isAdmin)
    {
        <div class="PostControlPanel">
            <a class="btn btn-default delete-btn" href="@Href("~/Posts/Delete/" + Model.ID)">حذف پست <span class="glyphicon glyphicon-trash"></span></a>
            <a class="btn btn-default edit-btn" href="@Href("~/Posts/EditPost/" + Model.ID)">ویرایش پست <span class="glyphicon glyphicon-edit"></span></a>
        </div>
    }
    <div id="showComment" class="btn btn-primary btn-block">
         نظرات (@Model.Comments.Count()) <span class="glyphicon glyphicon-circle-arrow-down"></span>
    </div>
</div>

<!-- -------------Comments----------------- -->
    
    @if(showComments == true){
        <div id="commentContainer">
            <a id="comments"></a>
            @foreach(Comment comment in Model.Comments.OrderByDescending(x => x.DateTime))
            {
             <div class="comment">
                 <div class="commentName">
                     @if (isAdmin && !string.IsNullOrWhiteSpace(comment.Email))
                     {
                         <span class="glyphicon glyphicon-user"></span> @comment.Name <br />
                         <span class="glyphicon glyphicon-envelope"></span> <a class="emailLink" href="mailto:@comment.Email">@comment.Email</a> <br />
                         @:می گوید:
                     }
                     else if (isAdmin && string.IsNullOrWhiteSpace(comment.Email))
                     {
                         <span class="glyphicon glyphicon-user"></span> @comment.Name <br />
                         <span class="glyphicon glyphicon-envelope"></span> @:[ایمیل وارد نشده] <br />
                         @:می گوید:
                     }
                     else
                     {
                         <span class="glyphicon glyphicon-user"></span> @comment.Name
                         @:می گوید:
                     }
                 </div>
                 
                 <div class="commentBody">
                      @(new System.Web.HtmlString(comment.Body))
                 </div>
                 <div class="commentTime">
                     @comment.DateTime.ToString("HH:mm:ss") - @pc.GetYear(comment.DateTime)/@pc.GetMonth(comment.DateTime)/@pc.GetDayOfMonth(comment.DateTime) <span class="glyphicon glyphicon-calendar"></span>
                 </div>
                 @if (isAdmin)
                 {
                    <div class="CommentControlPanel">
                        <br />
                        <a href="@Href("~/Posts/DeleteComment/" + comment.ID)" class="btn btn-danger btn-block"><span class="glyphicon glyphicon-trash"></span> حذف این نظر</a>
                    </div>
                 }
             </div> 
            }
            <a class="btn btn-primary btn-block" href="@Url.Content("~/Posts/CreateComment/"+ Model.ID)">نظر خود را وارد کنید</a>
        </div>    
    }
        